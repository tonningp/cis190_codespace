#!/bin/bash

echo "üöÄ Starting the exercises ..."
python3 -m pip install --quiet  --upgrade pip
export TOP_DIR="$(dirname "$(realpath "$0")")"
export BASE_DIR=${PWD}
export PROFILE_DB="$(dirname $TOP_DIR)/.db/profile.sqlite3"

if [[ ! -f ${PROFILE_DB} ]];then
   echo 
   echo "‚ùå student profile not found. Please run ./bootstrap again."
   echo
   exit 1
fi
if [[ "$BASE_DIR" != *week_* ]]; then
  echo "‚ùå No modules found, make sure to start this in directory for the week"
  echo "For example /workspaces/codespaces-blank/cis190_codespace/missions/week_1"
  exit 1
fi

# Ensure pip is available
if ! command -v pip3 &> /dev/null; then
    echo "‚ùå pip not found. Please install Python and pip first."
    exit 1
fi


for PACKAGE in rich asciinema;do
	if ! pip3 show "$PACKAGE" > /dev/null 2>&1; then
	    echo "üîç $PACKAGE not found. Installing..."
	    pip3 install --no-warn-script-location --quiet "$PACKAGE"
	fi
done
source "$TOP_DIR/environment.sh"
if [[ ${BASE_DIR} != *module* ]]; then
  echo "‚ùå This script must be run in a module directory."
  echo "Please navigate to a module directory and try again."
  echo $(ls -1 ${BASE_DIR})
  exit 1
fi
run_lecture
