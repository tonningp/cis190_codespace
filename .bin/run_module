#!/bin/bash
clear
# Change to the base directory
cd "$BASE_DIR" || exit 1
#clear
# List of base names for the lecture modules
# Auto-detect module base names from markdown files or directories in .content
export MODULES=(
  $(find "$MARKDOWN_DIR" -maxdepth 1 -type f -name "*.md" \
    -exec basename {} .md \; | sort)
)

# Loop through modules
for module in "${MODULES[@]}"; do
  clear
  md_file="$MARKDOWN_DIR/${module}.md"
  cast_file="$DEMO_DIR/${module}.cast"
  script_file="$DEMO_DIR/${module}.sh"

  #echo "processing $md_file"
  if [[ -f "$md_file" ]]; then
    echo "Reading module: ${module}"
    ${CAT_CMD} ${md_file}
    pause
  fi

  #echo "processing $cast_file"
  if [[ -f "$cast_file" ]]; then
    ${VPLAYER} "$cast_file"
    pause
  fi

  if [[ -f "$script_file" && -x "$script_file" ]]; then
    #echo "Executing demo script in a recorded shell: $script_file"
    if [[ ! -s "${script_file}" ]];then
        recorder
    else
        recorder ${script_file}
    fi
#    if [[ ${script_file} == *"grade"* ]]; then
#        echo "${0}"
#        echo "This topic is going to be graded."
#    fi
    pause
  fi
done
submit_lab.sh
read -p "Press Enter to continue to the next module or exit."
echo "üèÅ Mission Complete!"
